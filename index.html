<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PDI - Jornada de Carreira</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Fonts: Plus Jakarta Sans -->
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">

    <style>
        body { font-family: 'Plus Jakarta Sans', sans-serif; }
        
        /* Fundo Gradiente Animado Suave */
        .bg-gradient-animate {
            background: linear-gradient(-45deg, #fdfbf7, #f3e8ff, #e0e7ff, #f0f9ff);
            background-size: 400% 400%;
            animation: gradientBG 15s ease infinite;
        }

        @keyframes gradientBG {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        
        .fade-in { animation: fadeIn 0.5s cubic-bezier(0.2, 0.8, 0.2, 1) forwards; }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px) scale(0.98); }
            to { opacity: 1; transform: translateY(0) scale(1); }
        }

        .input-focus:focus { 
            box-shadow: 0 0 0 4px rgba(124, 58, 237, 0.1); 
            border-color: #8b5cf6;
        }

        .input-error {
            border-color: #ef4444 !important;
            box-shadow: 0 0 0 4px rgba(239, 68, 68, 0.1);
        }
        
        .glass-panel {
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.5);
        }

        .radio-card-selected { 
            border-color: #8b5cf6; 
            background: linear-gradient(to bottom right, #ffffff, #f5f3ff);
            box-shadow: 0 10px 30px -10px rgba(139, 92, 246, 0.2);
        }

        /* Novas Abas Destacadas */
        .tab-btn {
            position: relative;
            transition: all 0.3s ease;
        }
        
        .tab-active {
            background-color: #8b5cf6; /* violet-600 */
            color: white;
            box-shadow: 0 4px 12px rgba(139, 92, 246, 0.3);
            border-color: #7c3aed;
        }

        .tab-inactive {
            background-color: white;
            color: #64748b; /* slate-500 */
            border-color: #e2e8f0; /* slate-200 */
        }
        
        .tab-inactive:hover {
            background-color: #f8fafc;
            border-color: #cbd5e1;
            color: #475569;
        }

        /* Indicador de preenchimento na aba */
        .tab-filled-indicator::after {
            content: '';
            position: absolute;
            top: 6px;
            right: 6px;
            width: 8px;
            height: 8px;
            background-color: #10b981; /* emerald-500 */
            border-radius: 50%;
            border: 2px solid white;
        }
        
        /* Scrollbar customizada */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
    </style>
</head>
<body class="bg-gradient-animate text-slate-700 antialiased min-h-screen flex flex-col selection:bg-violet-200 selection:text-violet-900">

    <!-- HEADER -->
    <header class="fixed top-0 w-full z-40 transition-all duration-300">
        <div class="glass-panel border-b border-white/50 shadow-sm">
            <div class="max-w-5xl mx-auto px-6 h-20 flex justify-between items-center">
                <div class="flex items-center gap-3">
                    <!-- ÍCONE: Bússola -->
                    <div class="bg-gradient-to-tr from-violet-600 to-fuchsia-500 w-10 h-10 rounded-xl flex items-center justify-center shadow-lg shadow-violet-200 text-white transform hover:scale-105 transition-all duration-300">
                        <svg class="w-6 h-6" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><polygon points="16.24 7.76 14.12 14.12 7.76 16.24 9.88 9.88"/></svg>
                    </div>
                    <div>
                        <h1 class="font-bold text-lg text-slate-800 tracking-tight leading-none" data-key="header_title">Jornada de Carreira</h1>
                        <p class="text-xs text-slate-500 mt-0.5 font-medium" data-key="header_subtitle">Seu Plano de Desenvolvimento Individual</p>
                    </div>
                </div>
                
                <div class="flex flex-col items-end gap-1.5">
                    <span class="text-[8px] text-slate-400 font-semibold tracking-wide uppercase opacity-70">Dev: Vinicius Carlos</span>
                    <!-- BOTÃO IDIOMA -->
                    <button onclick="toggleLanguage()" class="glass-panel group flex items-center gap-3 px-4 py-2 rounded-xl hover:bg-white transition-all shadow-sm hover:shadow-md cursor-pointer border border-white/60">
                        <span class="text-xs font-bold text-slate-500 group-hover:text-violet-700 transition-colors hidden sm:inline" data-key="lang_label_desc">Escolha seu idioma:</span>
                        <div class="flex items-center gap-1.5 bg-violet-50 px-2 py-0.5 rounded-md border border-violet-100 group-hover:border-violet-200 transition-colors">
                            <span class="w-1.5 h-1.5 rounded-full bg-violet-500 group-hover:animate-pulse"></span>
                            <span id="lang-label" class="text-xs font-black text-violet-700">PT</span>
                        </div>
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- MAIN CONTENT -->
    <main class="flex-grow max-w-5xl mx-auto w-full px-6 pt-32 pb-32">
        
        <!-- STEP 0: WELCOME -->
        <div id="step-0" class="step-content fade-in max-w-3xl mx-auto text-center py-8">
            <div class="inline-flex items-center gap-2 px-4 py-1.5 rounded-full text-xs font-bold uppercase tracking-wider bg-white border border-violet-100 text-violet-600 shadow-sm mb-8 hover:scale-105 transition-transform cursor-default">
                <span class="w-1.5 h-1.5 rounded-full bg-violet-500"></span>
                <span data-key="welcome_badge">Sua Carreira</span>
            </div>
            
            <h2 class="text-4xl md:text-6xl font-extrabold text-slate-800 mb-6 tracking-tight leading-tight bg-clip-text text-transparent bg-gradient-to-r from-slate-800 to-slate-600" data-key="welcome_title">Vamos desenhar seu futuro?</h2>
            
            <p class="text-lg md:text-xl text-slate-500 leading-relaxed mb-10 max-w-2xl mx-auto font-light" data-key="welcome_desc">Este é um espaço seguro para você refletir. O PDI não é uma burocracia, é a estratégia da sua própria evolução.</p>
            
            <div class="grid md:grid-cols-2 gap-6 mb-12 text-left">
                <!-- Time Card -->
                <div class="glass-panel p-8 rounded-3xl hover:border-violet-200 transition-all shadow-sm hover:shadow-xl group relative overflow-hidden">
                    <div class="absolute top-0 right-0 w-32 h-32 bg-orange-100/50 rounded-bl-full -mr-8 -mt-8 transition-all group-hover:bg-orange-100 group-hover:scale-110"></div>
                    <div class="relative z-10">
                        <div class="w-12 h-12 bg-white rounded-2xl flex items-center justify-center text-orange-500 shadow-sm mb-5 border border-orange-50 group-hover:-translate-y-1 transition-transform">
                            <svg class="w-6 h-6" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
                        </div>
                        <h3 class="font-bold text-slate-800 text-lg mb-2 group-hover:text-orange-600 transition-colors">Tempo de Qualidade</h3>
                        <p class="text-slate-600 font-medium text-sm leading-relaxed" data-key="welcome_time_warn">Que tal reservar 20 minutos para focar no que realmente importa: você? Ao final, geramos um arquivo prontinho para facilitar o registro no Success Factors.</p>
                    </div>
                </div>

                <!-- Protagonist Card -->
                <div class="glass-panel p-8 rounded-3xl hover:border-violet-200 transition-all shadow-sm hover:shadow-xl group relative overflow-hidden">
                    <div class="absolute top-0 right-0 w-32 h-32 bg-violet-100/50 rounded-bl-full -mr-8 -mt-8 transition-all group-hover:bg-violet-100 group-hover:scale-110"></div>
                    <div class="relative z-10">
                        <div class="w-12 h-12 bg-white rounded-2xl flex items-center justify-center text-violet-600 shadow-sm mb-5 border border-violet-50 group-hover:-translate-y-1 transition-transform">
                            <svg class="w-6 h-6" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>
                        </div>
                        <h3 class="font-bold text-slate-800 text-lg mb-2 group-hover:text-violet-700 transition-colors">Protagonismo</h3>
                        <p class="text-slate-600 font-medium text-sm leading-relaxed" data-key="welcome_note">Você é o protagonista. Use este rascunho para organizar suas ideias com clareza antes de alinhar com sua liderança.</p>
                    </div>
                </div>
            </div>
            
            <button onclick="nextStep()" class="group relative bg-slate-900 text-white px-10 py-5 rounded-2xl font-bold text-lg shadow-xl shadow-slate-300/50 hover:shadow-slate-400/50 hover:-translate-y-1 transition-all overflow-hidden mx-auto flex items-center gap-3">
                <div class="absolute inset-0 w-full h-full bg-gradient-to-r from-violet-600 to-fuchsia-600 opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>
                <span class="relative z-10" data-key="btn_start">Iniciar Jornada</span>
                <svg class="relative z-10 w-5 h-5 group-hover:translate-x-1 transition-transform" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M5 12h14"/><path d="m12 5 7 7-7 7"/></svg>
            </button>
        </div>

        <!-- STEP 1: REFLECTION CHOICE -->
        <div id="step-1" class="step-content hidden fade-in max-w-5xl mx-auto">
            <div class="text-center mb-10">
                <span class="text-violet-600 font-bold tracking-wider text-xs uppercase mb-2 block" data-key="step_reflect_badge">Fase 1 • Direção</span>
                <h2 class="text-3xl md:text-4xl font-bold text-slate-800 mb-3" data-key="step_reflect_title">Definindo o Foco</h2>
                <p class="text-slate-500 text-lg font-light" data-key="step_reflect_sub">Antes de traçar a meta, qual é o seu objetivo principal neste ciclo?</p>
            </div>

            <div class="grid md:grid-cols-3 gap-6 mb-8">
                <!-- Option Current -->
                <div id="card-current" onclick="selectReflection('current')" class="glass-panel cursor-pointer p-6 rounded-3xl hover:border-violet-300 transition-all shadow-sm hover:shadow-lg group h-full flex flex-col justify-center relative overflow-hidden">
                    <div class="absolute top-0 right-0 w-24 h-24 bg-violet-100/50 rounded-bl-full -mr-4 -mt-4 transition-all group-hover:bg-violet-100"></div>
                    
                    <div class="relative z-10">
                        <div class="w-12 h-12 bg-white rounded-2xl flex items-center justify-center text-violet-600 shadow-sm mb-4 border border-violet-50">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2v20"/><path d="M2 12h20"/><circle cx="12" cy="12" r="10"/></svg>
                        </div>
                        <h3 class="font-bold text-lg text-slate-800 mb-2 group-hover:text-violet-700 transition-colors" data-key="opt_current_title">Fortalecer Posição Atual</h3>
                        <p class="text-xs text-slate-500 leading-relaxed" data-key="opt_current_desc">Foco na excelência, aprofundamento técnico e desenvolvimento de soft skills para a função.</p>
                    </div>
                    <div id="check-current" class="hidden absolute bottom-6 right-6 bg-violet-600 text-white rounded-full p-1.5 shadow-lg animate-bounce">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"/></svg>
                    </div>
                </div>

                <!-- Option Dual (RENAMED TO DUPLO FOCO) -->
                <div id="card-dual" onclick="selectReflection('dual')" class="glass-panel cursor-pointer p-6 rounded-3xl hover:border-teal-300 transition-all shadow-sm hover:shadow-lg group h-full flex flex-col justify-center relative overflow-hidden">
                    <div class="absolute top-0 right-0 w-24 h-24 bg-teal-100/50 rounded-bl-full -mr-4 -mt-4 transition-all group-hover:bg-teal-100"></div>
                    
                    <div class="relative z-10">
                        <div class="w-12 h-12 bg-white rounded-2xl flex items-center justify-center text-teal-600 shadow-sm mb-4 border border-teal-50">
                             <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2v20"/><path d="M2 12h20"/><path d="m13 17 5-5-5-5"/></svg>
                        </div>
                        <h3 class="font-bold text-lg text-slate-800 mb-2 group-hover:text-teal-700 transition-colors" data-key="opt_dual_title">Duplo Foco</h3>
                        <p class="text-xs text-slate-500 leading-relaxed" data-key="opt_dual_desc">Desenvolvimento estratégico que equilibra entregas na função atual com preparação para o próximo passo.</p>
                    </div>
                    <div id="check-dual" class="hidden absolute bottom-6 right-6 bg-teal-600 text-white rounded-full p-1.5 shadow-lg animate-bounce">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"/></svg>
                    </div>
                </div>

                <!-- Option Future -->
                <div id="card-future" onclick="selectReflection('future')" class="glass-panel cursor-pointer p-6 rounded-3xl hover:border-fuchsia-300 transition-all shadow-sm hover:shadow-lg group h-full flex flex-col justify-center relative overflow-hidden">
                    <div class="absolute top-0 right-0 w-24 h-24 bg-fuchsia-100/50 rounded-bl-full -mr-4 -mt-4 transition-all group-hover:bg-fuchsia-100"></div>
                    
                    <div class="relative z-10">
                        <div class="w-12 h-12 bg-white rounded-2xl flex items-center justify-center text-fuchsia-600 shadow-sm mb-4 border border-fuchsia-50">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m13 17 5-5-5-5"/><path d="m6 17 5-5-5-5"/></svg>
                        </div>
                        <h3 class="font-bold text-lg text-slate-800 mb-2 group-hover:text-fuchsia-700 transition-colors" data-key="opt_future_title">Próximo Passo</h3>
                        <p class="text-xs text-slate-500 leading-relaxed" data-key="opt_future_desc">Preparação exclusiva para novos desafios, expansão de escopo e competências de liderança.</p>
                    </div>
                    <div id="check-future" class="hidden absolute bottom-6 right-6 bg-fuchsia-600 text-white rounded-full p-1.5 shadow-lg animate-bounce">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"/></svg>
                    </div>
                </div>
            </div>
        </div>

        <!-- STEP 2: REFLECTION DEEP DIVE -->
        <div id="step-2" class="step-content hidden fade-in max-w-4xl mx-auto">
            <div class="text-center mb-8">
                <span class="text-violet-600 font-bold tracking-wider text-xs uppercase mb-2 block" data-key="step_deep_badge">Fase 2 • Profundidade</span>
                <h2 class="text-3xl font-bold text-slate-800 mb-2" data-key="step_deep_title">Reflexão Guiada</h2>
                <p class="text-slate-500" data-key="step_deep_sub">Responda às perguntas abaixo para fundamentar sua meta.</p>
            </div>
            
            <div id="reflection-container" class="space-y-8">
                <!-- Javascript will populate this with 1 or 2 blocks -->
            </div>
        </div>

        <!-- STEP 3: META -->
        <div id="step-3" class="step-content hidden fade-in max-w-4xl mx-auto">
            <div class="text-center mb-10">
                <span class="text-violet-600 font-bold tracking-wider text-xs uppercase mb-2 block" data-key="step1_badge">Fase 3 • Objetivos</span>
                <h2 class="text-3xl font-bold text-slate-800 mb-2" data-key="step1_title">Qual é o seu foco?</h2>
                <p class="text-slate-500" data-key="step1_sub">Agora vamos transformar sua reflexão em uma meta clara.</p>
            </div>

            <div id="goals-container" class="space-y-8">
                <!-- Javascript will populate this -->
            </div>
        </div>

        <!-- STEP 4: METHODOLOGY (70/20/10) -->
        <div id="step-4" class="step-content hidden fade-in max-w-5xl mx-auto">
            <div class="flex flex-col md:flex-row justify-between items-end mb-8 gap-6">
                <div>
                    <span class="text-violet-600 font-bold tracking-wider text-xs uppercase mb-2 block" data-key="step2_badge">Fase 4 • Metodologia</span>
                    <h2 class="text-3xl font-bold text-slate-800 mb-2" data-key="step2_title">Como vamos chegar lá?</h2>
                    
                    <div class="flex gap-4 mt-4 text-slate-600 max-w-2xl bg-white/70 backdrop-blur-md p-5 rounded-2xl border border-white shadow-sm">
                        <div class="bg-violet-100 p-2 rounded-lg h-fit text-violet-600">
                            <svg class="w-5 h-5" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/></svg>
                        </div>
                        <div>
                            <strong class="block text-slate-800 text-sm mb-1 font-bold" data-key="step2_intro_title">A Regra 70/20/10</strong>
                            <p class="text-sm leading-relaxed text-slate-500" data-key="step2_intro_desc">A ciência mostra que aprendemos mais praticando do que estudando. Para seu plano ser robusto, ele precisa cobrir três frentes:</p>
                        </div>
                    </div>
                </div>
                <button onclick="openModal('ideas')" class="bg-white hover:bg-slate-50 border border-slate-200 text-slate-700 px-5 py-3 rounded-xl font-bold hover:border-violet-300 hover:text-violet-600 transition-all shadow-sm flex items-center gap-2 whitespace-nowrap">
                    <svg class="w-4 h-4" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2a10 10 0 1 0 10 10 4 4 0 0 1-5-5 4 4 0 0 1-5-5"/><path d="M8.5 8.5v.01"/><path d="M16 15.5v.01"/><path d="M12 12v.01"/><path d="M8.5 15.5v.01"/><path d="M15.5 8.5v.01"/></svg>
                    <span data-key="btn_ideas">Banco de Ideias</span>
                </button>
            </div>

            <!-- Tabs for Dual mode (STYLE UPDATED) -->
            <div id="methodology-tabs" class="hidden flex space-x-4 border-b border-slate-200 mb-6">
                <button id="tab-btn-p1" onclick="switchMethodologyTab('p1')" class="tab-btn py-3 px-6 rounded-t-xl font-bold text-sm border-x border-t flex items-center gap-2 tab-active">
                    <span>Foco 1: Atual</span>
                </button>
                <button id="tab-btn-p2" onclick="switchMethodologyTab('p2')" class="tab-btn py-3 px-6 rounded-t-xl font-bold text-sm border-x border-t flex items-center gap-2 tab-inactive">
                    <span>Foco 2: Futuro</span>
                </button>
            </div>

            <!-- Methodology Input Container -->
            <div id="methodology-inputs-container">
                <!-- Inputs generated dynamically -->
            </div>
        </div>

        <!-- STEP 5: METRICS -->
        <div id="step-5" class="step-content hidden fade-in max-w-4xl mx-auto">
            <div class="text-center mb-10">
                <span class="text-violet-600 font-bold tracking-wider text-xs uppercase mb-2 block" data-key="step3_badge">Fase 5 • Compromisso</span>
                <h2 class="text-3xl font-bold text-slate-800 mb-2" data-key="step3_title">Indicadores e Prazos</h2>
                <p class="text-slate-500" data-key="step3_desc">Um objetivo sem prazo é apenas um sonho. Como vamos medir o sucesso de cada ação?</p>
            </div>

            <div id="metrics-container" class="space-y-6">
                <!-- Will be populated by JS -->
            </div>
        </div>

        <!-- STEP 6: REVIEW -->
        <div id="step-6" class="step-content hidden fade-in max-w-4xl mx-auto">
            <div class="flex justify-between items-center mb-8">
                <div>
                    <span class="text-violet-600 font-bold tracking-wider text-xs uppercase mb-2 block" data-key="step4_badge">Fase 6 • Revisão</span>
                    <h2 class="text-3xl font-bold text-slate-800 mt-2" data-key="step4_title">Seu Plano Consolidado</h2>
                </div>
                <button onclick="checkDownloadAndFinish()" class="bg-slate-900 text-white px-6 py-3 rounded-xl font-bold shadow-xl shadow-slate-300 hover:bg-slate-800 transition-all flex items-center gap-2 hover:-translate-y-1">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" x2="12" y1="15" y2="3"/></svg>
                    <span data-key="btn_export">Baixar Documento (.doc)</span>
                </button>
            </div>

            <div class="bg-white/90 backdrop-blur rounded-[2rem] p-10 shadow-2xl shadow-slate-200 border border-white space-y-10 relative overflow-hidden">
                <div class="absolute top-0 right-0 w-64 h-64 bg-gradient-to-br from-violet-100/50 to-transparent rounded-bl-full pointer-events-none"></div>

                <div class="relative z-10" id="review-content"></div>
                
                <div class="mt-8 pt-6 border-t border-slate-100 flex items-start gap-4 bg-gradient-to-r from-violet-50 to-transparent p-6 rounded-2xl relative z-10">
                    <div class="p-2 bg-white rounded-lg shadow-sm text-violet-600">
                         <svg class="w-5 h-5" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L12 3Z"/><path d="M5 3v4"/><path d="M9 5H3"/></svg>
                    </div>
                    <div>
                        <h4 class="font-bold text-violet-900 text-sm mb-1 uppercase tracking-wide" data-key="tip_title">Insight de Carreira</h4>
                        <p class="text-sm text-slate-700 leading-relaxed font-medium" id="tip-text">...</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- STEP 7: SYSTEM REGISTRATION WARNING -->
        <div id="step-7" class="step-content hidden fade-in flex flex-col items-center justify-center min-h-[50vh] max-w-xl mx-auto text-center px-4">
            <div class="bg-white/90 backdrop-blur-md rounded-[2.5rem] shadow-2xl shadow-amber-200/50 border-4 border-amber-100 p-10 w-full relative overflow-hidden">
                <div class="absolute -top-10 -right-10 w-40 h-40 bg-amber-100 rounded-full blur-3xl opacity-60"></div>
                <div class="absolute -bottom-10 -left-10 w-40 h-40 bg-orange-100 rounded-full blur-3xl opacity-60"></div>
                <div class="relative z-10 flex flex-col items-center">
                    <div class="w-20 h-20 bg-amber-100 rounded-full flex items-center justify-center mb-6 text-amber-600 shadow-inner">
                        <svg class="w-10 h-10 animate-pulse" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 9v4"/><path d="M12 17h.01"/><path d="M3.4 18.2 12 3.8l8.6 14.4H3.4Z"/></svg>
                    </div>
                    <h2 class="text-3xl font-extrabold text-slate-800 mb-4" data-key="warn_title">Atenção Necessária</h2>
                    <p class="text-slate-600 text-lg mb-8 leading-relaxed font-medium" data-key="warn_desc">O PDI não termina aqui. Ele é um documento vivo e precisa estar visível para a companhia.</p>
                    <div class="bg-amber-50 border border-amber-200 rounded-2xl p-6 w-full text-left mb-8">
                        <p class="text-xs font-bold text-amber-600 uppercase tracking-widest mb-3 text-center" data-key="warn_path_label">Assegure o registro no Success Factors</p>
                        <div class="flex items-center justify-center gap-2 font-bold text-slate-800 text-lg bg-white p-3 rounded-xl border border-amber-100 shadow-sm">
                            <svg class="w-5 h-5 text-amber-500" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>
                            <span data-key="warn_path">Home > Objetivos > Metas</span>
                        </div>
                    </div>
                    <p class="text-sm text-slate-500 italic mb-8" data-key="warn_note">O registro oficial garante o suporte da liderança e a visibilidade para oportunidades futuras.</p>
                    <button onclick="nextStep()" class="w-full bg-slate-900 text-white py-4 rounded-xl font-bold text-lg hover:bg-slate-800 hover:scale-[1.02] transition-all shadow-xl shadow-slate-300">
                        <span data-key="warn_btn">Entendi, vou registrar</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- STEP 8: FINAL -->
        <div id="step-8" class="step-content hidden fade-in flex flex-col items-center justify-center min-h-[50vh] max-w-xl mx-auto text-center">
            <div class="w-28 h-28 bg-gradient-to-tr from-emerald-100 to-teal-50 rounded-full flex items-center justify-center mb-8 shadow-inner relative">
                <svg class="w-12 h-12 text-teal-600" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><path d="m9 11 3 3L22 4"/></svg>
                <div class="absolute inset-0 rounded-full animate-ping opacity-20 bg-emerald-400"></div>
            </div>
            <h2 class="text-4xl font-bold text-slate-800 mb-4" data-key="final_title">Parabéns pela iniciativa!</h2>
            <p class="text-lg text-slate-500 mb-10 leading-relaxed" data-key="final_desc">O primeiro passo foi dado. Agora é hora de tirar do papel.</p>
            <div class="bg-amber-50/80 border border-amber-100 rounded-2xl p-6 mb-10 flex gap-4 items-start text-left w-full">
                <div class="bg-amber-100 p-2 rounded-lg text-amber-600 flex-shrink-0">
                    <svg class="w-6 h-6" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg>
                </div>
                <div>
                    <h4 class="font-bold text-slate-800 text-sm uppercase tracking-wide mb-1" data-key="final_alert_title">Lembre-se</h4>
                    <p class="text-slate-600 leading-relaxed text-sm" data-key="final_alert_text">Agende o alinhamento com seu líder para validar este plano. Se precisar de apoio, seu HRBP está à disposição.</p>
                </div>
            </div>
            <button onclick="resetApp()" class="text-slate-400 hover:text-violet-600 font-bold px-6 py-3 transition-colors flex items-center gap-2 text-sm">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12a9 9 0 0 0-9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/><path d="M3 12a9 9 0 0 0 9 9 9.75 9.75 0 0 0 6.74-2.74L21 16"/><path d="M16 16h5v5"/></svg>
                <span data-key="btn_restart">Criar Novo Plano</span>
            </button>
        </div>
    </main>

    <!-- FOOTER NAV -->
    <div id="footer-nav" class="hidden fixed bottom-6 left-0 w-full z-40 pointer-events-none">
        <div class="max-w-5xl mx-auto px-6 flex justify-between items-center pointer-events-auto">
            <button onclick="prevStep()" class="glass-panel text-slate-600 font-bold px-6 py-3 rounded-full hover:bg-white hover:text-violet-700 transition-all shadow-lg flex items-center gap-2 text-sm backdrop-blur-md">
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m12 19-7-7 7-7"/><path d="M19 12H5"/></svg>
                <span data-key="nav_prev">Voltar</span>
            </button>
            <button id="btn-next" onclick="nextStep()" class="bg-slate-900 text-white px-8 py-3 rounded-full font-bold hover:bg-slate-800 transition-all shadow-xl shadow-slate-400/30 flex items-center gap-2 hover:-translate-y-1 transform">
                <span data-key="nav_next">Continuar</span>
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m9 18 6-6-6-6"/></svg>
            </button>
        </div>
    </div>

    <!-- MAIN MODAL (Ideas & Competencies) -->
    <div id="modal" class="hidden fixed inset-0 z-50 flex items-center justify-center p-4">
        <div class="absolute inset-0 bg-slate-900/40 backdrop-blur-sm transition-opacity" onclick="closeModal()"></div>
        <div class="bg-white w-full max-w-4xl max-h-[85vh] rounded-[2rem] shadow-2xl flex flex-col overflow-hidden animate-fade-in relative z-10">
            <div class="p-6 border-b border-slate-100 flex justify-between items-center bg-slate-50">
                <h3 id="modal-title" class="font-bold text-xl text-slate-800"></h3>
                <button onclick="closeModal()" class="w-10 h-10 rounded-full bg-white border border-slate-200 hover:bg-red-50 hover:text-red-500 hover:border-red-200 flex items-center justify-center text-slate-400 transition-all">✕</button>
            </div>
            <div id="modal-content" class="p-8 overflow-y-auto"></div>
        </div>
    </div>

    <!-- DOWNLOAD WARNING MODAL -->
    <div id="download-modal" class="hidden fixed inset-0 z-50 flex items-center justify-center p-4">
        <div class="absolute inset-0 bg-slate-900/40 backdrop-blur-sm transition-opacity"></div>
        <div class="bg-white w-full max-w-md rounded-2xl shadow-2xl overflow-hidden animate-fade-in relative z-10">
            <div class="p-8 text-center">
                <div class="w-16 h-16 bg-amber-50 rounded-full flex items-center justify-center mx-auto mb-4 text-amber-500 ring-4 ring-amber-50">
                    <svg class="w-8 h-8" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" x2="12" y1="15" y2="3"/></svg>
                </div>
                <h3 class="font-bold text-xl text-slate-800 mb-2" data-key="dl_modal_title">Você já baixou seu plano?</h3>
                <p class="text-slate-500 text-sm leading-relaxed" data-key="dl_modal_desc">Se você avançar sem baixar, perderá o arquivo Word gerado. Recomendamos baixar agora.</p>
            </div>
            <div class="flex border-t border-slate-100">
                <button onclick="skipDownload()" class="flex-1 py-4 text-slate-500 font-bold hover:bg-slate-50 transition-colors text-sm" data-key="dl_modal_skip">Seguir sem baixar</button>
                <button onclick="confirmDownload()" class="flex-1 py-4 bg-slate-900 text-white font-bold hover:bg-slate-800 transition-colors text-sm" data-key="dl_modal_btn">Baixar Agora</button>
            </div>
        </div>
    </div>

    <!-- SCRIPT LOGIC -->
    <script>
        // --- DADOS ---
        const DATA = {
            competencies: {
                pt: [
                    "Liderança Ágil", "Inteligência Emocional", "Comunicação Assertiva", 
                    "Pensamento Estratégico", "Gestão de Conflitos", "Análise de Dados",
                    "Gestão de Projetos", "Inovação e Criatividade", "Visão de Negócio",
                    "Trabalho em Equipe", "Resiliência / Adaptabilidade", "Gestão do Tempo",
                    "Negociação", "Orientação para Resultados", "Autogestão"
                ],
                es: [
                    "Liderazgo Ágil", "Inteligencia Emocional", "Comunicación Asertiva", 
                    "Pensamiento Estratégico", "Gestión de Conflictos", "Análisis de Datos",
                    "Gestión de Proyectos", "Innovación y Creatividad", "Visión de Negocio",
                    "Trabajo en Equipo", "Resiliencia / Adaptabilidad", "Gestión del Tiempo",
                    "Negociación", "Orientación a Resultados", "Autogestión"
                ]
            },
            reflectionQuestions: {
                pt: {
                    current: [
                        "Qual é o principal desafio da sua função hoje que, se superado, mudaria o patamar da sua entrega?",
                        "Que legado ou impacto positivo você quer deixar na sua área neste ciclo?",
                        "Quais habilidades técnicas ou comportamentais você precisa afiar para dominar sua cadeira?",
                        "O que os seus feedbacks recentes dizem? Existe algum ponto de melhoria recorrente?",
                        "Propósito: Por que evoluir no seu papel atual é importante para você pessoalmente?"
                    ],
                    future: [
                        "Qual cadeira, projeto ou responsabilidade você almeja assumir no curto/médio prazo?",
                        "Que tipo de valor você espera gerar para a empresa nessa nova posição?",
                        "O que ainda falta na sua bagagem (experiência ou conhecimento) para você estar pronto?",
                        "Ao comparar seu perfil atual com o perfil desejado, onde está a maior lacuna (gap)?",
                        "Propósito: O que esse próximo passo representa para a sua realização pessoal?"
                    ]
                },
                es: {
                    current: [
                        "¿Cuál es el principal desafío de su función hoy que, si se supera, cambiaría el nivel de su entrega?",
                        "¿Qué legado o impacto positivo quiere dejar en su área en este ciclo?",
                        "¿Qué habilidades técnicas o comportamentales necesita afinar para dominar su puesto?",
                        "¿Qué dicen sus feedbacks recientes? ¿Hay algún punto de mejora recurrente?",
                        "Propósito: ¿Por qué evolucionar en su papel actual es importante para usted personalmente?"
                    ],
                    future: [
                        "¿Qué puesto, proyecto o responsabilidad aspira a asumir en el corto/mediano plazo?",
                        "¿Qué tipo de valor espera generar para la empresa en esa nueva posición?",
                        "¿Qué le falta aún en su bagaje (experiencia o conocimiento) para estar listo?",
                        "Al comparar su perfil actual con el perfil deseado, ¿dónde está la mayor brecha (gap)?",
                        "Propósito: ¿Qué representa este próximo paso para su realización personal?"
                    ]
                }
            },
            ideas: {
                pt: {
                    s70: ["Realizar Shadowing", "Job Rotation", "Projetos transversais", "Atuar em crises", "Lançar novo programa", "Resolver problema crônico", "Melhoria de processos", "Ministrar treinamento", "Facilitar reuniões", "Liderar grupo de projeto", "Visitas a clientes", "Processos orçamentários"],
                    s20: ["Feedbacks (Gestor/Pares)", "Mentoria (Mentor/Mentorado)", "Role Model", "Benchmarking", "Grupos de discussão", "Fóruns técnicos", "Feedback pós-projeto"],
                    s10: ["Treinamentos Formais", "Vídeos/Webinars", "Leitura técnica", "Certificações", "Congressos", "Treinamentos comportamentais"]
                },
                es: {
                    s70: ["Realizar Shadowing", "Job Rotation", "Proyectos transversales", "Actuar en crisis", "Lanzar nuevo programa", "Resolver problema crónico", "Mejora de procesos", "Impartir formación", "Facilitar reuniones", "Liderar grupo de proyecto", "Visitas a clientes", "Procesos presupuestarios"],
                    s20: ["Feedbacks (Gestor/Pares)", "Mentoría (Mentor/Mentorado)", "Role Model", "Benchmarking", "Grupos de discusión", "Foros técnicos", "Feedback post-proyecto"],
                    s10: ["Entrenamientos Formales", "Videos/Webinars", "Lectura técnica", "Certificaciones", "Congresos", "Entrenamientos comportamentales"]
                }
            },
            tips: {
                pt: [
                    "Conecte sua meta ao negócio: Pergunte-se 'Como desenvolver essa competência ajuda minha área a bater as metas do ano?'. Isso aumenta o apoio da liderança.",
                    "Feedback não é apenas sobre o passado. Peça 'Feedforward': pergunte 'O que posso fazer diferente no próximo projeto para ter mais impacto?'.",
                    "Não subestime o 20% (Relacionamentos). Mapeie quem são os tomadores de decisão que precisam conhecer seu trabalho e crie uma rotina de troca com eles.",
                    "Transforme teoria em processo. Ao terminar um curso (10%), crie um checklist ou ferramenta prática para o time. Isso consolida seu aprendizado e gera legado.",
                    "Evidência de sucesso deve ser observável. Em vez de 'melhorar comunicação', prefira 'apresentar os resultados mensais para a liderança com zero dúvidas sobre os dados'."
                ],
                es: [
                    "Conecta tu meta al negocio: Pregúntate '¿Cómo desarrollar esta competencia ayuda a mi área a alcanzar las metas del año?'. Esto aumenta el apoyo del liderazgo.",
                    "El feedback no es solo sobre el pasado. Pide 'Feedforward': pregunta '¿Qué puedo hacer diferente en el próximo proyecto para tener más impacto?'.",
                    "No subestimes el 20% (Relaciones). Mapea quiénes son los tomadores de decisiones que necesitan conocer tu trabajo y crea una rutina de intercambio con ellos.",
                    "Transforma teoría en proceso. Al terminar un curso (10%), crea un checklist o herramienta práctica para el equipo. Esto consolida tu aprendizaje y genera legado.",
                    "La evidencia de éxito debe ser observable. En lugar de 'mejorar comunicación', prefiere 'presentar los resultados mensuales al liderazgo con cero dudas sobre los datos'."
                ]
            }
        };

        const TRANSLATIONS = {
            pt: {
                header_title: "Jornada de Carreira",
                header_subtitle: "Seu Plano de Desenvolvimento Individual",
                btn_start: "Iniciar Jornada",
                welcome_badge: "Sua Carreira",
                welcome_title: "Vamos desenhar seu futuro?",
                welcome_desc: "Este é um espaço seguro para você refletir. O PDI não é uma burocracia, é a estratégia da sua própria evolução.",
                welcome_note: "Você é o protagonista. Use este rascunho para organizar suas ideias com clareza antes de alinhar com sua liderança.",
                welcome_time_warn: "Que tal reservar 20 minutos para focar no que realmente importa: você? Ao final, geramos um arquivo prontinho para facilitar o registro no Success Factors.",
                
                step_reflect_title: "Definindo o Foco",
                step_reflect_sub: "Antes de traçar a meta, qual é o seu objetivo principal neste ciclo?",
                step_reflect_badge: "Fase 1 • Direção",
                
                step_deep_title: "Reflexão Guiada",
                step_deep_sub: "Responda às perguntas abaixo para fundamentar sua meta.",
                step_deep_badge: "Fase 2 • Profundidade",
                
                step1_title: "Qual é o seu foco?",
                step1_badge: "Fase 3 • Objetivos",
                step1_sub: "Agora vamos transformar sua reflexão em uma meta clara.",
                
                step2_title: "Como vamos chegar lá?",
                step2_badge: "Fase 4 • Metodologia",
                
                step3_title: "Indicadores e Prazos",
                step3_badge: "Fase 5 • Compromisso",
                
                step4_title: "Seu Plano Consolidado",
                step4_badge: "Fase 6 • Revisão",
                
                final_title: "Parabéns pela iniciativa!",
                btn_export: "Baixar Documento (.doc)",
                label_evidence: "Evidência de Sucesso",
                label_date: "Data Limite",
                nav_next: "Continuar",
                nav_prev: "Voltar",
                nav_finish: "Concluir",
                helper_goal_connected: "Com base nos insights que você escreveu, qual é a <strong>meta principal</strong>? Seja específico.",
                
                opt_current_title: "Fortalecer Posição Atual",
                opt_current_desc: "Foco em excelência na função, aprofundamento técnico e desenvolvimento de competências comportamentais.",
                
                opt_dual_title: "Duplo Foco",
                opt_dual_desc: "Desenvolvimento estratégico que equilibra entregas na função atual com preparação para o próximo passo.",

                opt_future_title: "Próximo Passo",
                opt_future_desc: "Preparação para novos desafios, expansão de escopo e desenvolvimento de habilidades técnicas e comportamentais.",
                
                questions_title: "Perguntas para provocar seu pensamento:",
                label_notes: "Suas Reflexões e Insights",
                step2_intro_title: "A Regra 70/20/10",
                step2_intro_desc: "A ciência mostra que aprendemos mais praticando do que estudando. Para seu plano ser robusto, ele precisa cobrir três frentes:",
                btn_ideas: "Banco de Ideias",
                label_70: "Experiência",
                expl_70: "Aprender fazendo, resolvendo problemas reais.",
                label_20: "Relacionamentos",
                expl_20: "Aprender com os outros, trocando experiências.",
                label_10: "Educação",
                expl_10: "Cursos, livros e teoria.",
                final_desc: "O primeiro passo foi dado. Agora é hora de tirar do papel.",
                final_alert_title: "Lembre-se",
                final_alert_text: "Agende o alinhamento com seu líder para validar este plano. Se precisar de apoio, seu HRBP está à disposição.",
                
                label_goal: "Meta de Desenvolvimento",
                helper_goal: "O que você quer conquistar? Pode ser melhorar sua performance atual, preparar-se para um futuro cargo ou potencializar um talento natural que você já tem.",
                label_comp: "Competência Principal",
                helper_comp: "Qual habilidade será a chave para atingir essa meta?",
                btn_comp_ideas: "Ver sugestões",
                
                label_target: "Foco de Carreira",
                place_target: "Ex: Coordenador de RH, Liderar Projeto X...",
                
                step3_desc: "Um objetivo sem prazo é apenas um sonho. Como vamos medir o sucesso de cada ação?",
                modal_title_competencies: "Competências Sugeridas",
                modal_title_ideas: "Banco de Ideias (PDI Eficaz)",
                
                place_notes: "Escreva aqui suas conclusões baseadas nas perguntas acima...",
                place_goal: "Ex: Desenvolver a competência X para assumir a responsabilidade Y...",
                place_comp: "Ex: Liderança Situacional...",
                place_70: "Qual desafio prático você vai assumir?",
                place_20: "Quem será seu mentor ou fonte de feedback?",
                place_10: "O que você precisa estudar?",
                place_evid: "O que comprova a conclusão?",
                msg_required: "Este campo é obrigatório",
                msg_dual_required: "Preencha ao menos uma ação nas duas abas (Atual e Futuro) para avançar.",
                
                dl_modal_title: "Você já baixou seu plano?",
                dl_modal_desc: "Se você avançar sem baixar, perderá o arquivo Word gerado. Recomendamos baixar agora.",
                dl_modal_btn: "Baixar Agora",
                dl_modal_skip: "Seguir sem baixar",
                
                tip_title: "Insight de Carreira",

                lang_label_desc: "Escolha seu idioma:",
                
                warn_title: "Atenção Necessária",
                warn_desc: "O PDI não termina aqui. Ele é um documento vivo e precisa estar visível para a companhia.",
                warn_path_label: "Assegure o registro no Success Factors",
                warn_path: "Home > Objetivos > Metas",
                warn_note: "O registro oficial garante o suporte da liderança e a visibilidade para oportunidades futuras.",
                warn_btn: "Entendi, vou registrar"
            },
            es: {
                header_title: "Jornada de Carrera",
                header_subtitle: "Su Plan de Desarrollo Individual",
                btn_start: "Empezar Jornada",
                welcome_badge: "Su Carrera",
                welcome_title: "¿Diseñamos tu futuro?",
                welcome_desc: "Este es un espacio seguro para reflexionar. El PDI no es una burocracia, es la estrategia de tu propia evolución.",
                welcome_note: "Eres el protagonista. Usa este borrador para organizar tus ideas con claridad antes de alinear con tu liderazgo.",
                welcome_time_warn: "¿Qué tal reservar 20 minutos para enfocarte en lo que realmente importa: tú? Al final, generamos un archivo listo para facilitar el registro en Success Factors.",
                
                step_reflect_title: "Definiendo el Enfoque",
                step_reflect_sub: "¿Antes de trazar la meta, cuál es tu objetivo principal en este ciclo?",
                step_reflect_badge: "Fase 1 • Dirección",
                
                step_deep_title: "Reflexión Guiada",
                step_deep_sub: "Responde las preguntas a continuación para fundamentar tu meta.",
                step_deep_badge: "Fase 2 • Profundidad",
                
                step1_title: "¿Cuál es tu enfoque?",
                step1_badge: "Fase 3 • Objetivos",
                step1_sub: "Ahora vamos a transformar tu reflexión en una meta clara.",

                step2_title: "¿Cómo llegaremos allí?",
                step2_badge: "Fase 4 • Metodología",
                
                step3_title: "Indicadores y Plazos",
                step3_badge: "Fase 5 • Compromiso",
                
                step4_title: "Tu Plan Consolidado",
                step4_badge: "Fase 6 • Revisión",
                
                final_title: "¡Felicidades por la iniciativa!",
                btn_export: "Descargar Documento (.doc)",
                label_evidence: "Evidencia de Éxito",
                label_date: "Fecha Límite",
                nav_next: "Continuar",
                nav_finish: "Concluir",
                nav_prev: "Volver",
                helper_goal_connected: "Con base en los insights que escribiste, ¿cuál es la <strong>meta principal</strong>? Sé específico.",
                
                opt_current_title: "Fortalecer Posición Actual",
                opt_current_desc: "Enfoque en la excelencia en la función, profundización técnica y desarrollo de competencias comportamentales.",
                
                opt_dual_title: "Doble Enfoque",
                opt_dual_desc: "Desarrollo estratégico que equilibra entregas en la función actual con preparación para el próximo paso.",

                opt_future_title: "Próximo Paso",
                opt_future_desc: "Preparación para nuevos desafíos, expansión de alcance y desarrollo de habilidades técnicas y comportamentales.",
                
                questions_title: "Preguntas para provocar tu pensamiento:",
                label_notes: "Tus Reflexiones e Insights",
                step2_intro_title: "La Regla 70/20/10",
                step2_intro_desc: "La ciencia muestra que aprendemos más practicando que estudiando. Para que tu plan sea robusto, debe cubrir tres frentes:",
                btn_ideas: "Banco de Ideas",
                label_70: "Experiencia",
                expl_70: "Aprender haciendo, resolviendo problemas reales.",
                label_20: "Relaciones",
                expl_20: "Aprender con otros, intercambiando experiencias.",
                label_10: "Educación",
                expl_10: "Cursos, libros y teoría.",
                final_desc: "El primer paso fue dado. Ahora es momento de actuar.",
                final_alert_title: "Recuerda",
                final_alert_text: "Agenda la alineación con tu líder para validar este plan. Si necesitas apoyo, tu HRBP está a disposición.",
                
                label_goal: "Meta de Desarrollo",
                helper_goal: "¿Qué quieres lograr? Puede ser mejorar tu desempeño actual, prepararte para un cargo futuro o potenciar un talento natural que ya tienes.",
                label_comp: "Competencia Principal",
                helper_comp: "¿Qué habilidad será clave para alcanzar esa meta?",
                btn_comp_ideas: "Ver sugerencias",
                
                label_target: "Enfoque de Carrera",
                place_target: "Ej: Coordinador de RRHH, Liderar Proyecto X...",

                step3_desc: "Un objetivo sin plazo es solo un sueño. ¿Cómo mediremos el éxito de cada acción?",
                modal_title_competencies: "Competencias Sugeridas",
                modal_title_ideas: "Banco de Ideas (PDI Eficaz)",
                
                place_notes: "Escribe aquí tus conclusiones basadas en las preguntas anteriores...",
                place_goal: "Ej: Desarrollar la competencia X para asumir la responsabilidad Y...",
                place_comp: "Ej: Liderazgo Situacional...",
                place_70: "¿Qué desafío práctico asumirás?",
                place_20: "¿Quién será tu mentor o fuente de feedback?",
                place_10: "¿Qué necesitas estudiar?",
                place_evid: "¿Qué prueba la conclusión?",
                msg_required: "Este campo es obligatorio",
                msg_dual_required: "Complete al menos una acción en ambas pestañas (Actual y Futuro) para avanzar.",
                
                dl_modal_title: "¿Ya descargaste tu plan?",
                dl_modal_desc: "Si avanzas sin descargar, perderás el archivo Word generado. Recomendamos descargar ahora.",
                dl_modal_btn: "Descargar Ahora",
                dl_modal_skip: "Seguir sin descargar",
                
                tip_title: "Insight de Carrera",

                lang_label_desc: "Cambiar idioma:",
                
                warn_title: "Atención Necesaria",
                warn_desc: "El PDI no termina aquí. Es un documento vivo y necesita ser visible para la compañía.",
                warn_path_label: "Asegure el registro en Success Factors",
                warn_path: "Inicio > Objetivos > Metas",
                warn_note: "El registro oficial garantiza el apoyo del liderazgo y la visibilidad para futuras oportunidades.",
                warn_btn: "Entendido, voy a registrar"
            }
        };

        // --- ESTADO ---
        let currentStep = 0;
        let currentLang = 'pt';
        let reflectionChoice = null; 
        let hasDownloaded = false;
        let activeMethodologyTab = 'p1'; 
        let activeCompInputId = '';

        // --- FUNÇÕES ---

        function init() {
            updateLanguage();
            showStep(0);
            updateTip();
        }

        function updateTip() {
            const tipList = DATA.tips[currentLang];
            const tip = tipList[Math.floor(Math.random() * tipList.length)];
            const tipEl = document.getElementById('tip-text');
            if(tipEl) tipEl.innerText = tip;
        }

        function toggleLanguage() {
            currentLang = currentLang === 'pt' ? 'es' : 'pt';
            document.getElementById('lang-label').innerText = currentLang.toUpperCase();
            updateLanguage();
            updateTip(); 
            
            if (currentStep === 2) generateReflectionFields();
            if (currentStep === 3) generateGoalsFields();
            if (currentStep === 4) generateMethodologyFields(); 
            if (currentStep === 5) generateMetricsFields();
            if (currentStep === 6) generateReview();
        }

        function updateLanguage() {
            const t = TRANSLATIONS[currentLang];
            document.querySelectorAll('[data-key]').forEach(el => {
                const key = el.getAttribute('data-key');
                if(t[key]) {
                    if(key === 'helper_goal_connected') el.innerHTML = t[key];
                    else el.innerText = t[key];
                }
            });
            document.querySelectorAll('[data-placeholder]').forEach(el => {
                const key = el.getAttribute('data-placeholder');
                if(t[key]) el.placeholder = t[key];
            });
        }

        function showStep(step) {
            document.querySelectorAll('.step-content').forEach(el => el.classList.add('hidden'));
            
            const currentEl = document.getElementById(`step-${step}`);
            if(currentEl) currentEl.classList.remove('hidden');
            
            const footer = document.getElementById('footer-nav');
            if(step > 0 && step < 7) footer.classList.remove('hidden');
            else footer.classList.add('hidden');

            const btnNextText = document.querySelector('[data-key="nav_next"]');
            if(btnNextText) {
                if(step === 6) btnNextText.innerText = (currentLang === 'pt' ? 'Concluir' : 'Concluir');
                else btnNextText.innerText = (currentLang === 'pt' ? 'Continuar' : 'Continuar');
            }

            window.scrollTo(0, 0);
        }

        function checkDownloadAndFinish() {
            if (!hasDownloaded) {
                document.getElementById('download-modal').classList.remove('hidden');
            } else {
                nextStep();
            }
        }

        function skipDownload() {
            document.getElementById('download-modal').classList.add('hidden');
            hasDownloaded = true; 
            nextStep();
        }

        function confirmDownload() {
            exportToWord();
            document.getElementById('download-modal').classList.add('hidden');
        }

        function validateInputs(containerId) {
            const container = document.getElementById(containerId);
            if (!container) return true;
            
            const inputs = container.querySelectorAll('textarea, input[type="text"]');
            let isValid = true;
            let firstInvalid = null;

            inputs.forEach(input => {
                if (!input.value.trim()) {
                    isValid = false;
                    input.classList.add('input-error');
                    if(!firstInvalid) firstInvalid = input;
                    
                    // Remove erro ao digitar
                    input.addEventListener('input', function() {
                        this.classList.remove('input-error');
                    }, {once: true});
                }
            });

            if (!isValid && firstInvalid) {
                firstInvalid.focus();
                alert(TRANSLATIONS[currentLang].msg_required);
            }
            return isValid;
        }

        function nextStep() {
            // STEP 1: CHOICE
            if (currentStep === 1) {
                if (!reflectionChoice) {
                    alert(currentLang === 'pt' ? "Por favor, selecione um objetivo." : "Por favor, seleccione un objetivo.");
                    return;
                }
                generateReflectionFields();
            }

            // STEP 2: REFLECTION (Validation)
            if (currentStep === 2) {
                if (!validateInputs('reflection-container')) return;
                generateGoalsFields();
            }

            // STEP 3: GOALS (Validation)
            if (currentStep === 3) {
                if (!validateInputs('goals-container')) return;
                generateMethodologyFields();
            }

            // STEP 4: METHODOLOGY (Validation for Dual Mode)
            if (currentStep === 4) {
                if (reflectionChoice === 'dual') {
                    // Check if P1 has at least one value
                    const p1Valid = hasContent('meth-container-p1');
                    const p2Valid = hasContent('meth-container-p2');

                    if (!p1Valid || !p2Valid) {
                        alert(TRANSLATIONS[currentLang].msg_dual_required);
                        
                        // Highlight empty tab
                        if (!p1Valid) switchMethodologyTab('p1');
                        else if (!p2Valid) switchMethodologyTab('p2');
                        return;
                    }
                } else {
                    // Single mode validation (optional, but good practice to require at least one action)
                    if (!hasContent('meth-container-p1')) {
                         alert(currentLang === 'pt' ? "Preencha ao menos uma ação (70, 20 ou 10) para continuar." : "Complete al menos una acción para continuar.");
                         return;
                    }
                }
                generateMetricsFields();
            }

            if (currentStep === 5) generateReview(); 
            
            if (currentStep < 8) {
                currentStep++;
                showStep(currentStep);
            }
        }
        
        function hasContent(containerId) {
            const container = document.getElementById(containerId);
            if(!container) return false;
            const inputs = container.querySelectorAll('textarea');
            for(let input of inputs) {
                if(input.value.trim()) return true;
            }
            return false;
        }

        function prevStep() {
            if (currentStep > 0) {
                currentStep--;
                showStep(currentStep);
            }
        }

        function resetApp() {
            document.querySelectorAll('input, textarea').forEach(el => {
                el.value = '';
                el.classList.remove('input-error');
            });
            currentStep = 0;
            reflectionChoice = null;
            hasDownloaded = false;
            activeMethodologyTab = 'p1';
            document.querySelectorAll('[id^="card-"]').forEach(el => el.classList.remove('radio-card-selected'));
            document.querySelectorAll('[id^="check-"]').forEach(el => el.classList.add('hidden'));
            showStep(0);
        }

        // --- STEP 1: CHOICE ---
        function selectReflection(choice) {
            reflectionChoice = choice;
            document.querySelectorAll('[id^="card-"]').forEach(el => el.classList.remove('radio-card-selected'));
            document.querySelectorAll('[id^="check-"]').forEach(el => el.classList.add('hidden'));
            const card = document.getElementById(`card-${choice}`);
            const check = document.getElementById(`check-${choice}`);
            if(card) card.classList.add('radio-card-selected');
            if(check) check.classList.remove('hidden');
            
            setTimeout(() => {
                nextStep();
            }, 300);
        }

        // --- GENERATORS ---

        function generateReflectionFields() {
            const container = document.getElementById('reflection-container');
            container.innerHTML = '';

            const createBlock = (type, suffix, titleOverride) => {
                const questions = DATA.reflectionQuestions[currentLang][type].map(q => `<li class="mb-2">${q}</li>`).join('');
                const title = titleOverride || (type === 'current' ? 
                    (currentLang === 'pt' ? 'Foco: Posição Atual' : 'Enfoque: Posición Actual') : 
                    (currentLang === 'pt' ? 'Foco: Próximo Passo' : 'Enfoque: Próximo Paso'));

                return `
                <div class="bg-white/80 backdrop-blur-xl rounded-3xl shadow-xl shadow-slate-200/50 border border-white overflow-hidden mb-6">
                    <div class="bg-gradient-to-r from-violet-50 to-white p-6 border-b border-violet-100">
                         <h4 class="font-bold text-violet-700 text-sm uppercase tracking-wide mb-2">${title}</h4>
                         <ul class="space-y-2 text-sm text-slate-600 list-disc pl-5 marker:text-violet-400">${questions}</ul>
                    </div>
                    <div class="p-6">
                        <label class="block text-sm font-bold text-slate-700 uppercase tracking-wide mb-3 flex items-center gap-2">
                            ${TRANSLATIONS[currentLang].label_notes} <span class="text-red-500">*</span>
                        </label>
                        <textarea id="input-reflection-notes-${suffix}" class="input-focus w-full p-4 bg-slate-50 border-0 ring-1 ring-slate-200 rounded-2xl outline-none text-slate-700 min-h-[120px] resize-none text-base" data-placeholder="place_notes" placeholder="${TRANSLATIONS[currentLang].place_notes}"></textarea>
                    </div>
                </div>`;
            };

            if (reflectionChoice === 'dual') {
                container.innerHTML += createBlock('current', 'p1');
                container.innerHTML += createBlock('future', 'p2');
            } else {
                container.innerHTML += createBlock(reflectionChoice, 'p1');
            }
        }

        function generateGoalsFields() {
            const container = document.getElementById('goals-container');
            container.innerHTML = '';

            const createGoalBlock = (suffix, label, isFuture) => {
                let extraField = '';
                if(isFuture) {
                    extraField = `
                    <div class="mb-6">
                         <label class="block text-sm font-bold text-slate-700 mt-2 flex items-center gap-2">
                            ${TRANSLATIONS[currentLang].label_target} <span class="text-red-500">*</span>
                        </label>
                        <p class="text-xs text-slate-500 mt-1 mb-2">Qual posição, área ou projeto você almeja?</p>
                        <input id="input-target-${suffix}" type="text" class="input-focus w-full p-4 text-lg bg-white border border-slate-200 rounded-2xl outline-none text-slate-700" data-placeholder="place_target" placeholder="${TRANSLATIONS[currentLang].place_target}">
                    </div>
                    `;
                }

                return `
                <div class="glass-panel rounded-3xl p-8 mb-6 shadow-sm border-l-8 ${suffix === 'p1' ? 'border-violet-400' : 'border-teal-400'}">
                    <span class="text-xs font-bold uppercase ${suffix === 'p1' ? 'bg-violet-100 text-violet-700' : 'bg-teal-100 text-teal-700'} px-2 py-1 rounded mb-4 inline-block">${label}</span>
                    
                    ${extraField}

                    <div class="mb-6">
                         <label class="block text-sm font-bold text-slate-700 mt-2 flex items-center gap-2">
                            ${TRANSLATIONS[currentLang].label_goal} <span class="text-red-500">*</span>
                        </label>
                        <textarea id="input-goal-${suffix}" class="input-focus w-full p-4 text-lg bg-white border border-slate-200 rounded-2xl outline-none text-slate-700 min-h-[100px] resize-none mt-2" data-placeholder="place_goal" placeholder="${TRANSLATIONS[currentLang].place_goal}"></textarea>
                    </div>
                    
                    <div>
                        <div class="flex justify-between items-center mb-2">
                            <label class="block text-sm font-bold text-slate-700 flex items-center gap-2">
                                ${TRANSLATIONS[currentLang].label_comp} <span class="text-red-500">*</span>
                            </label>
                            <button onclick="openModal('competencies', 'input-comp-${suffix}')" class="text-xs font-bold text-violet-600 bg-violet-50 px-3 py-1 rounded-full hover:bg-violet-100 transition-colors border border-violet-100">
                                ${TRANSLATIONS[currentLang].btn_comp_ideas}
                            </button>
                        </div>
                        <input id="input-comp-${suffix}" type="text" class="input-focus w-full p-4 text-lg bg-white border border-slate-200 rounded-2xl outline-none text-slate-700" data-placeholder="place_comp" placeholder="${TRANSLATIONS[currentLang].place_comp}">
                    </div>
                </div>`;
            };

            if (reflectionChoice === 'dual') {
                container.innerHTML += createGoalBlock('p1', currentLang === 'pt' ? 'Contexto Atual' : 'Contexto Actual', false);
                container.innerHTML += createGoalBlock('p2', currentLang === 'pt' ? 'Olhar Futuro' : 'Mirada Futura', true);
            } else if (reflectionChoice === 'future') {
                 container.innerHTML += createGoalBlock('p1', currentLang === 'pt' ? 'Próximo Passo' : 'Próximo Paso', true);
            } else {
                container.innerHTML += createGoalBlock('p1', currentLang === 'pt' ? 'Meta Principal' : 'Meta Principal', false);
            }
        }

        function generateMethodologyFields() {
            const container = document.getElementById('methodology-inputs-container');
            const tabs = document.getElementById('methodology-tabs');
            
            if (reflectionChoice === 'dual') {
                tabs.classList.remove('hidden');
            } else {
                tabs.classList.add('hidden');
                activeMethodologyTab = 'p1';
            }

            renderMethodologyInputs();
            checkTabStatus(); // Update visual indicators
        }

        function switchMethodologyTab(tab) {
            activeMethodologyTab = tab;
            
            // Toggle classes visually
            const btnP1 = document.getElementById('tab-btn-p1');
            const btnP2 = document.getElementById('tab-btn-p2');
            
            if (tab === 'p1') {
                btnP1.classList.remove('tab-inactive');
                btnP1.classList.add('tab-active');
                btnP2.classList.remove('tab-active');
                btnP2.classList.add('tab-inactive');
            } else {
                btnP2.classList.remove('tab-inactive');
                btnP2.classList.add('tab-active');
                btnP1.classList.remove('tab-active');
                btnP1.classList.add('tab-inactive');
            }
            
            renderMethodologyInputs();
        }
        
        // Adds a dot if content exists in that tab
        function checkTabStatus() {
            if(reflectionChoice !== 'dual') return;
            
            const btnP1 = document.getElementById('tab-btn-p1');
            const btnP2 = document.getElementById('tab-btn-p2');
            
            if(hasContent('meth-container-p1')) btnP1.classList.add('tab-filled-indicator');
            else btnP1.classList.remove('tab-filled-indicator');
            
            if(hasContent('meth-container-p2')) btnP2.classList.add('tab-filled-indicator');
            else btnP2.classList.remove('tab-filled-indicator');
        }

        function renderMethodologyInputs() {
            const container = document.getElementById('methodology-inputs-container');
            
            if (!document.getElementById('meth-container-p1')) {
                container.innerHTML = ''; 
                container.insertAdjacentHTML('beforeend', create702010Block('p1'));
                container.insertAdjacentHTML('beforeend', create702010Block('p2'));
                
                // Add listeners to update tab status on type
                const allTextareas = container.querySelectorAll('textarea');
                allTextareas.forEach(el => el.addEventListener('input', checkTabStatus));
            }

            document.getElementById('meth-container-p1').classList.add('hidden');
            document.getElementById('meth-container-p2').classList.add('hidden');
            
            if(reflectionChoice === 'dual') {
                document.getElementById(`meth-container-${activeMethodologyTab}`).classList.remove('hidden');
            } else {
                document.getElementById('meth-container-p1').classList.remove('hidden');
            }
        }

        function create702010Block(suffix) {
             const t = TRANSLATIONS[currentLang];
             return `
             <div id="meth-container-${suffix}" class="grid md:grid-cols-3 gap-6 animate-fade-in">
                <!-- 70% -->
                <div class="bg-white/80 backdrop-blur rounded-3xl overflow-hidden shadow-sm hover:shadow-xl transition-all border border-white group">
                    <div class="bg-gradient-to-r from-emerald-500 to-teal-500 p-1"></div>
                    <div class="p-6">
                        <div class="flex justify-between items-start mb-4">
                            <span class="text-4xl font-extrabold text-emerald-500 tracking-tighter opacity-80">70%</span>
                            <span class="text-[10px] font-bold uppercase text-emerald-700 bg-emerald-100 px-2 py-1 rounded-full">${t.label_70}</span>
                        </div>
                        <p class="text-sm text-slate-500 mb-6 font-medium">${t.expl_70}</p>
                        <textarea id="input-70-${suffix}" class="input-focus w-full bg-slate-50 border border-slate-100 rounded-xl p-4 text-slate-700 outline-none resize-none h-40 text-sm transition-all focus:bg-white" placeholder="${t.place_70}"></textarea>
                    </div>
                </div>
                <!-- 20% -->
                <div class="bg-white/80 backdrop-blur rounded-3xl overflow-hidden shadow-sm hover:shadow-xl transition-all border border-white group">
                    <div class="bg-gradient-to-r from-amber-500 to-orange-500 p-1"></div>
                    <div class="p-6">
                        <div class="flex justify-between items-start mb-4">
                            <span class="text-4xl font-extrabold text-amber-500 tracking-tighter opacity-80">20%</span>
                            <span class="text-[10px] font-bold uppercase text-amber-700 bg-amber-100 px-2 py-1 rounded-full">${t.label_20}</span>
                        </div>
                        <p class="text-sm text-slate-500 mb-6 font-medium">${t.expl_20}</p>
                        <textarea id="input-20-${suffix}" class="input-focus w-full bg-slate-50 border border-slate-100 rounded-xl p-4 text-slate-700 outline-none resize-none h-40 text-sm transition-all focus:bg-white" placeholder="${t.place_20}"></textarea>
                    </div>
                </div>
                <!-- 10% -->
                <div class="bg-white/80 backdrop-blur rounded-3xl overflow-hidden shadow-sm hover:shadow-xl transition-all border border-white group">
                    <div class="bg-gradient-to-r from-blue-500 to-indigo-500 p-1"></div>
                    <div class="p-6">
                        <div class="flex justify-between items-start mb-4">
                            <span class="text-4xl font-extrabold text-blue-500 tracking-tighter opacity-80">10%</span>
                            <span class="text-[10px] font-bold uppercase text-blue-700 bg-blue-100 px-2 py-1 rounded-full">${t.label_10}</span>
                        </div>
                        <p class="text-sm text-slate-500 mb-6 font-medium">${t.expl_10}</p>
                        <textarea id="input-10-${suffix}" class="input-focus w-full bg-slate-50 border border-slate-100 rounded-xl p-4 text-slate-700 outline-none resize-none h-40 text-sm transition-all focus:bg-white" placeholder="${t.place_10}"></textarea>
                    </div>
                </div>
            </div>`;
        }

        function generateMetricsFields() {
            const container = document.getElementById('metrics-container');
            if(!container) return;
            container.innerHTML = '';
            const t = TRANSLATIONS[currentLang];
            
            const createMetricsBlock = (suffix, label) => {
                const getVal = (id) => document.getElementById(id)?.value || '';
                const titles = {
                    '70': currentLang === 'pt' ? '70% Experiência' : '70% Experiencia',
                    '20': currentLang === 'pt' ? '20% Relacionamentos' : '20% Relaciones',
                    '10': currentLang === 'pt' ? '10% Educação' : '10% Educación'
                };
                const actions = [
                    { id: '70', text: getVal(`input-70-${suffix}`), color: 'emerald', title: titles['70'] },
                    { id: '20', text: getVal(`input-20-${suffix}`), color: 'amber', title: titles['20'] },
                    { id: '10', text: getVal(`input-10-${suffix}`), color: 'blue', title: titles['10'] }
                ];
                
                let html = `<h3 class="text-lg font-bold text-slate-800 border-b pb-2 mb-4">${label}</h3>`;
                let hasContent = false;
                
                actions.forEach(act => {
                    if(act.text.trim()) {
                        hasContent = true;
                        html += `
                            <div class="bg-white/90 backdrop-blur rounded-3xl shadow-sm border-l-4 border-${act.color}-500 p-6 border border-white mb-4">
                                <div class="flex items-center gap-2 mb-3">
                                    <span class="text-xs font-bold uppercase text-${act.color}-600 bg-${act.color}-50 px-2 py-1 rounded">${act.title}</span>
                                </div>
                                <p class="text-slate-700 mb-6 italic">"${act.text}"</p>
                                <div class="grid md:grid-cols-2 gap-6">
                                    <div>
                                        <label class="block text-xs font-bold text-slate-400 mb-1 uppercase tracking-wide">${t.label_evidence}</label>
                                        <input id="measure-${act.id}-${suffix}" class="input-focus w-full p-2 bg-slate-50 border border-slate-200 rounded-lg outline-none" placeholder="${t.place_evid}">
                                    </div>
                                    <div>
                                        <label class="block text-xs font-bold text-slate-400 mb-1 uppercase tracking-wide">${t.label_date}</label>
                                        <input id="date-${act.id}-${suffix}" type="date" class="input-focus w-full p-2 bg-slate-50 border border-slate-200 rounded-lg outline-none text-slate-600">
                                    </div>
                                </div>
                            </div>
                        `;
                    }
                });
                
                if (!hasContent) html += `<div class="text-slate-400 italic mb-6">Nenhuma ação definida para este bloco.</div>`;
                return html;
            };

            if (reflectionChoice === 'dual') {
                container.innerHTML += createMetricsBlock('p1', currentLang === 'pt' ? 'Foco 1: Posição Atual' : 'Enfoque 1: Posición Actual');
                container.innerHTML += createMetricsBlock('p2', currentLang === 'pt' ? 'Foco 2: Futuro' : 'Enfoque 2: Futuro');
            } else {
                container.innerHTML += createMetricsBlock('p1', currentLang === 'pt' ? 'Compromissos do Plano' : 'Compromisos del Plan');
            }
        }

        function generateReview() {
            const container = document.getElementById('review-content');
            if(!container) return;
            
            const createReviewSection = (suffix, title) => {
                const getVal = (id) => document.getElementById(id)?.value || '';
                const goal = getVal(`input-goal-${suffix}`);
                const comp = getVal(`input-comp-${suffix}`);
                const notes = getVal(`input-reflection-notes-${suffix}`);
                const target = getVal(`input-target-${suffix}`); // New Field

                const titles = {
                    '70': currentLang === 'pt' ? '70% Experiência' : '70% Experiencia',
                    '20': currentLang === 'pt' ? '20% Relacionamentos' : '20% Relaciones',
                    '10': currentLang === 'pt' ? '10% Educação' : '10% Educación'
                };
                
                const actions = [
                    { id: '70', text: getVal(`input-70-${suffix}`), meas: getVal(`measure-70-${suffix}`), date: getVal(`date-70-${suffix}`), title: titles['70'], color: 'text-emerald-600' },
                    { id: '20', text: getVal(`input-20-${suffix}`), meas: getVal(`measure-20-${suffix}`), date: getVal(`date-20-${suffix}`), title: titles['20'], color: 'text-amber-600' },
                    { id: '10', text: getVal(`input-10-${suffix}`), meas: getVal(`measure-10-${suffix}`), date: getVal(`date-10-${suffix}`), title: titles['10'], color: 'text-blue-600' }
                ];

                let actionsHtml = '';
                actions.forEach(a => {
                    if(a.text) {
                        actionsHtml += `
                            <div class="bg-slate-50/50 rounded-2xl p-6 border border-slate-200 mb-3">
                                <h4 class="font-bold ${a.color} mb-2 text-sm uppercase tracking-wide">${a.title}</h4>
                                <p class="text-slate-700 font-medium mb-4">${a.text}</p>
                                <div class="flex flex-wrap gap-4 text-xs text-slate-500 border-t border-slate-200 pt-3">
                                    <div><strong class="text-slate-400 uppercase tracking-wider">${TRANSLATIONS[currentLang].label_evidence}:</strong> <span class="text-slate-700 ml-1">${a.meas || '-'}</span></div>
                                    <div><strong class="text-slate-400 uppercase tracking-wider">${TRANSLATIONS[currentLang].label_date}:</strong> <span class="text-slate-700 ml-1">${a.date || '-'}</span></div>
                                </div>
                            </div>
                        `;
                    }
                });
                
                let targetHtml = '';
                if(target) {
                    targetHtml = `
                    <div class="mb-6">
                        <h3 class="text-xs font-black text-slate-400 uppercase tracking-widest mb-1">Posição/Projeto Alvo</h3>
                        <p class="text-xl font-bold text-violet-700 leading-tight">${target}</p>
                    </div>`;
                }

                return `
                    <div class="border-b border-slate-100 pb-8 mb-8">
                        <div class="inline-block bg-slate-900 text-white text-xs font-bold px-3 py-1 rounded mb-4 uppercase tracking-widest">${title}</div>
                        
                        ${notes ? `<div class="bg-indigo-50/30 p-5 rounded-xl mb-6 border border-indigo-50"><p class="text-xs font-bold text-indigo-400 uppercase mb-2">Reflexão</p><p class="text-sm text-slate-600 italic">"${notes}"</p></div>` : ''}

                        ${targetHtml}

                        <h3 class="text-xs font-black text-slate-400 uppercase tracking-widest mb-2">Objetivo de Desenvolvimento</h3>
                        <p class="text-xl font-bold text-slate-800 leading-tight mb-4">${goal || '---'}</p>
                        <div class="inline-block bg-fuchsia-50 px-4 py-2 rounded-lg text-fuchsia-700 text-sm font-bold border border-fuchsia-100 mb-6">${comp || 'Competência não definida'}</div>
                        
                        <div class="space-y-4">
                             <h4 class="text-sm font-bold text-slate-500">Ações Planejadas (70/20/10)</h4>
                             ${actionsHtml || '<p class="text-slate-400 italic">Sem ações definidas.</p>'}
                        </div>
                    </div>
                `;
            };

            container.innerHTML = '';
            
            if (reflectionChoice === 'dual') {
                container.innerHTML += createReviewSection('p1', currentLang === 'pt' ? 'Contexto 1: Posição Atual' : 'Contexto 1: Posición Actual');
                container.innerHTML += createReviewSection('p2', currentLang === 'pt' ? 'Contexto 2: Olhar Futuro' : 'Contexto 2: Mirada Futura');
            } else {
                let title = reflectionChoice === 'current' ? 'Foco: Atual' : 'Foco: Futuro';
                // If single future, check if we should add "Próximo Passo" in title? Nah, "Foco: Futuro" is fine.
                if (reflectionChoice === 'future') title = currentLang === 'pt' ? 'Foco: Próximo Passo' : 'Enfoque: Próximo Paso';
                container.innerHTML += createReviewSection('p1', title);
            }
        }

        // --- MODAL ---
        function openModal(type, targetInputId) {
            const modal = document.getElementById('modal');
            const title = document.getElementById('modal-title');
            const content = document.getElementById('modal-content');
            
            if(modal) modal.classList.remove('hidden');
            
            activeCompInputId = targetInputId || 'input-comp-p1';

            const t = TRANSLATIONS[currentLang];

            if (type === 'competencies') {
                if(title) title.innerText = t.modal_title_competencies;
                if(content) content.innerHTML = `<div class="grid md:grid-cols-2 gap-4">${DATA.competencies[currentLang].map(c => 
                    `<button onclick="selectComp('${c}')" class="text-left p-4 rounded-xl border border-slate-100 hover:border-violet-300 hover:bg-violet-50 transition-all font-medium text-slate-700 hover:text-violet-800 w-full">${c}</button>`
                ).join('')}</div>`;
            } else {
                if(title) title.innerText = t.modal_title_ideas;
                const ideas = DATA.ideas[currentLang];
                if(content) content.innerHTML = `
                    <div class="grid md:grid-cols-3 gap-8 text-sm">
                        <div class="space-y-3"><strong class="text-emerald-600 block border-b pb-2 text-lg">70%</strong><ul class="space-y-3 text-slate-600 list-disc pl-4 marker:text-emerald-300">${ideas.s70.map(i => `<li>${i}</li>`).join('')}</ul></div>
                        <div class="space-y-3"><strong class="text-amber-600 block border-b pb-2 text-lg">20%</strong><ul class="space-y-3 text-slate-600 list-disc pl-4 marker:text-amber-300">${ideas.s20.map(i => `<li>${i}</li>`).join('')}</ul></div>
                        <div class="space-y-3"><strong class="text-blue-600 block border-b pb-2 text-lg">10%</strong><ul class="space-y-3 text-slate-600 list-disc pl-4 marker:text-blue-300">${ideas.s10.map(i => `<li>${i}</li>`).join('')}</ul></div>
                    </div>
                `;
            }
        }

        function closeModal() {
            const modal = document.getElementById('modal');
            if(modal) modal.classList.add('hidden');
        }

        function selectComp(comp) {
            const input = document.getElementById(activeCompInputId);
            if(input) input.value = comp;
            closeModal();
        }

        function exportToWord() {
            hasDownloaded = true; 
            
            const contentEl = document.getElementById('review-content');
            if(!contentEl) return;
            const html = contentEl.innerHTML;
            const header = "<html xmlns:o='urn:schemas-microsoft-com:office:office' xmlns:w='urn:schemas-microsoft-com:office:word' xmlns='http://www.w3.org/TR/REC-html40'><head><meta charset='utf-8'><title>PDI</title></head><body>";
            const footer = "</body></html>";
            
            const cleanBody = `
                <h1 style="color:#333; font-family:sans-serif;">Meu Plano de Carreira</h1>
                <p style="color:#666; font-family:sans-serif;">Gerado em: ${new Date().toLocaleDateString()}</p>
                <hr/>
                ${html.replace(/class=".*?"/g, '')} 
                <hr/>
                <h3 style="font-family:sans-serif;">Próximo passo: Registre no Success Factors</h3>
                <p style="font-family:sans-serif;"><strong>Home > Objetivos > Metas</strong></p>
                <br/>
                <p style="font-size:10pt; color:#999; font-family:sans-serif;">Desenvolvido por Vinicius Carlos</p>
            `;

            const sourceHTML = header + cleanBody + footer;
            const source = 'data:application/vnd.ms-word;charset=utf-8,' + encodeURIComponent(sourceHTML);
            const fileDownload = document.createElement("a");
            document.body.appendChild(fileDownload);
            fileDownload.href = source;
            fileDownload.download = 'meu_pdi_consolidado.doc';
            fileDownload.click();
            document.body.removeChild(fileDownload);
        }

        init();

    </script>
</body>
</html>
